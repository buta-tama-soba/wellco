/// 強化された食材辞書
/// 日本食品成分表データから生成 + 手動で追加した高頻度食材
class EnhancedFoodDictionary {
  
  /// 高頻度食材の辞書（手動作成）
  static const Map<String, List<String>> commonIngredients = {
    // 豚肉（部位別）
    '豚バラ肉': ['豚バラ', 'ぶたばら', 'ブタバラ', '豚バラ肉', '豚ばら肉', 'ポークベリー'],
    '豚ロース': ['豚ロース肉', 'ぶたろーす', 'ブタロース', 'ポークロイン'],
    '豚もも肉': ['豚もも', 'ぶたもも', 'ブタモモ', '豚もも肉', 'ポークレッグ'],
    '豚肩肉': ['豚肩', 'ぶたかた', 'ブタカタ', '豚肩ロース', 'ポークショルダー'],
    '豚ひき肉': ['豚ひき', 'ぶたひき', 'ブタヒキ', '豚挽肉', '豚ミンチ'],
    '豚こま肉': ['豚こま', '豚小間', 'ぶたこま', 'ブタコマ', '豚こま切れ'],
    
    // 牛肉（部位別）
    '牛バラ肉': ['牛バラ', 'うしばら', 'ウシバラ', '牛バラ肉', 'ビーフリブ'],
    '牛ロース': ['牛ロース肉', 'うしろーす', 'ウシロース', 'ビーフロイン'],
    '牛もも肉': ['牛もも', 'うしもも', 'ウシモモ', '牛もも肉', 'ビーフラウンド'],
    '牛肩肉': ['牛肩', 'うしかた', 'ウシカタ', '牛肩ロース', 'ビーフチャック'],
    '牛ひき肉': ['牛ひき', 'うしひき', 'ウシヒキ', '牛挽肉', '牛ミンチ'],
    '牛こま肉': ['牛こま', '牛小間', 'うしこま', 'ウシコマ', '牛こま切れ'],
    
    // 鶏肉（部位別）
    '鶏もも肉': ['鶏もも', 'とりもも', 'トリモモ', '鶏モモ肉', 'チキンレッグ'],
    '鶏むね肉': ['鶏むね', '鶏胸肉', 'とりむね', 'トリムネ', 'チキンブレスト'],
    '鶏ささみ': ['ささみ', 'ササミ', '鶏ササミ', 'チキンテンダー'],
    '鶏手羽': ['手羽', '鶏手羽元', '鶏手羽先', 'チキンウィング'],
    '鶏ひき肉': ['鶏ひき', 'とりひき', 'トリヒキ', '鶏挽肉', '鶏ミンチ'],
    
    // 野菜類（頻出）
    '玉ねぎ': ['たまねぎ', 'タマネギ', '玉葱', '玉ネギ', 'オニオン'],
    '人参': ['にんじん', 'ニンジン', '人蔘', 'キャロット'],
    'ゴーヤ': ['ごーや', 'ゴーヤ', '苦瓜', 'にがうり'],
    'みつば': ['ミツバ', '三つ葉', '三葉'],
    'じゃがいも': ['ジャガイモ', 'じゃが芋', 'ジャガ芋', 'ポテト', 'ばれいしょ', '馬鈴薯'],
    'キャベツ': ['きゃべつ', 'キャベツ', 'かんらん', '甘藍'],
    '白菜': ['はくさい', 'ハクサイ', '白菜'],
    'トマト': ['とまと', 'トマト', 'とまとー', 'トメィト'],
    'なす': ['ナス', '茄子', 'なすび', '茄'],
    'ピーマン': ['ぴーまん', 'ピーマン', '青椒'],
    'きゅうり': ['キュウリ', '胡瓜', 'きうり'],
    '大根': ['だいこん', 'ダイコン', '大根'],
    'ほうれん草': ['ほうれんそう', 'ホウレンソウ', 'ほうれん草', 'ホウレン草'],
    'レタス': ['れたす', 'レタス'],
    'ブロッコリー': ['ぶろっこりー', 'ブロッコリー'],
    '貝割れ菜': ['かいわれな', 'カイワレナ', '貝割れ菜', 'かいわれ'],
    'もやし': ['モヤシ', 'もやし'],
    'ねぎ': ['ネギ', '葱', '長ネギ', '長ねぎ', '白ねぎ'],
    'ごぼう': ['ゴボウ', '牛蒡', 'ゴボー'],
    'れんこん': ['レンコン', '蓮根', 'はすね'],
    
    // きのこ類
    'しいたけ': ['シイタケ', '椎茸', 'しい茸'],
    'えのき': ['エノキ', 'えのき茸', 'エノキ茸', 'えのきだけ'],
    'しめじ': ['シメジ', 'しめじ茸', 'ぶなしめじ'],
    'まいたけ': ['マイタケ', '舞茸', 'まい茸'],
    'エリンギ': ['えりんぎ', 'エリンギ'],
    
    // 魚介類
    '鮭': ['さけ', 'サケ', 'サーモン', 'シャケ', 'しゃけ'],
    'まぐろ': ['マグロ', '鮪', 'ツナ', 'とろ'],
    'さば': ['サバ', '鯖', 'さばー'],
    'いわし': ['イワシ', '鰯'],
    'あじ': ['アジ', '鯵'],
    'えび': ['エビ', '海老', 'シュリンプ'],
    'いか': ['イカ', '烏賊', 'するめ'],
    'たこ': ['タコ', '蛸', 'オクトパス'],
    
    // 卵・乳製品
    '卵': ['たまご', 'タマゴ', '玉子', '鶏卵', 'エッグ'],
    '牛乳': ['ぎゅうにゅう', 'ギュウニュウ', 'ミルク', '牛乳'],
    'チーズ': ['ちーず', 'チーズ', 'cheese'],
    'バター': ['ばたー', 'バター', 'butter'],
    
    // 豆類
    '豆腐': ['とうふ', 'トウフ', '豆腐'],
    '焼き豆腐': ['やきどうふ', 'ヤキドウフ', '焼き豆腐', '焼豆腐'],
    '納豆': ['なっとう', 'ナットウ', '納豆'],
    '大豆': ['だいず', 'ダイズ', '大豆'],
    '枝豆': ['えだまめ', 'エダマメ', '枝豆'],
    
    // こんにゃく類
    '糸こんにゃく': ['いとこんにゃく', 'イトコンニャク', '糸こんにゃく', '糸蒟蒻'],
    
    // 調味料
    '塩': ['しお', 'シオ', 'salt', '食塩'],
    '砂糖': ['さとう', 'サトウ', 'sugar', '上白糖'],
    '醤油': ['しょうゆ', 'ショウユ', '醬油', 'しょう油'],
    '味噌': ['みそ', 'ミソ', '味噌'],
    '酢': ['す', 'ス', 'vinegar'],
    '油': ['あぶら', 'アブラ', 'oil'],
    'サラダ油': ['さらだ油', 'サラダ油', '米油', 'こめ油'],
    'オリーブオイル': ['オリーブ油', 'olive oil', 'オリーブ・オイル'],
    'ごま油': ['ゴマ油', '胡麻油', 'sesame oil'],
    '酒': ['さけ', 'サケ', '日本酒', '料理酒'],
    'みりん': ['ミリン', '味醂', 'mirin'],
    'こしょう': ['コショウ', 'pepper', '胡椒', '黒こしょう', '粗びき黒こしょう'],
    
    // 主食
    '米': ['こめ', 'コメ', 'ごはん', 'ご飯', 'ライス'],
    'パン': ['ぱん', 'パン', 'bread', '食パン'],
    'うどん': ['ウドン', '饂飩'],
    'そば': ['ソバ', '蕎麦'],
    'パスタ': ['ぱすた', 'パスタ', 'スパゲッティ', 'pasta'],
    'そうめん': ['ソウメン', '素麺', 'そーめん'],
    
    // 肉類（すき焼き用追加）
    '牛肉': ['ぎゅうにく', 'ギュウニク', 'すき焼き用牛肉', 'beef'],
    '牛脂': ['ぎゅうし', 'ギュウシ', '牛脂'],
    
    // その他頻出
    'にんにく': ['ニンニク', '大蒜', 'ガーリック'],
    'しょうが': ['ショウガ', '生姜', 'ジンジャー'],
    'ごま': ['ゴマ', '胡麻', 'sesame', 'いりごま', '白いりごま', '白ごま'],
    'のり': ['ノリ', '海苔', '焼きのり'],
    'わかめ': ['ワカメ', '若布'],
    'こんにゃく': ['コンニャク', '蒟蒻'],
    'とうもろこし': ['トウモロコシ', 'コーン', 'corn'],
    '合いびき肉': ['あいびきにく', 'アイビキニク', '合いびき肉', '合挽き肉'],
    '焼きそば用麺': ['やきそばようめん', 'ヤキソバヨウメン', '焼きそば麺', '中華麺'],
    '青のり': ['あおのり', 'アオノリ', '青のり', '青海苔'],
    '紅しょうが': ['べにしょうが', 'ベニショウガ', '紅しょうが', '紅生姜'],
    'ケチャップ': ['けちゃっぷ', 'ケチャップ', 'トマトケチャップ'],
    'ウスターソース': ['うすたーそーす', 'ウスターソース', 'ソース'],
    'オイスターソース': ['おいすたーそーす', 'オイスターソース', '牡蠣油'],
    'カレー粉': ['かれーこ', 'カレー粉', 'curry powder'],
    'アボカド': ['あぼかど', 'アボカド', 'avocado'],
    '小松菜': ['こまつな', 'コマツナ', '小松菜'],
    'オクラ': ['おくら', 'オクラ', 'okra'],
    'パプリカ': ['ぱぷりか', 'パプリカ', 'paprika'],
    'セロリ': ['せろり', 'セロリ', 'celery'],
    'アスパラ': ['あすぱら', 'アスパラガス', 'asparagus'],
    'さつまいも': ['サツマイモ', 'さつま芋', 'サツマ芋', '薩摩芋'],
    '里芋': ['さといも', 'サトイモ', '里芋'],
    'かぼちゃ': ['カボチャ', '南瓜', 'パンプキン'],
    '絹さや': ['きぬさや', 'キヌサヤ', '絹さや', '絹莢'],
    'ズッキーニ': ['ずっきーに', 'ズッキーニ', 'zucchini'],
    'みょうが': ['ミョウガ', '茗荷'],
    '大葉': ['おおば', 'オオバ', 'しそ', 'シソ', '紫蘇'],
    'バジル': ['ばじる', 'バジル', 'basil'],
    'パセリ': ['ぱせり', 'パセリ', 'parsley'],
    'ベーコン': ['べーこん', 'ベーコン', 'bacon'],
    'ハム': ['はむ', 'ハム', 'ham'],
    'ソーセージ': ['そーせーじ', 'ソーセージ', 'sausage', 'ウインナー'],
    'スパゲッティ': ['すぱげってぃ', 'スパゲッティ', 'スパゲティ', 'spaghetti'],
    'ポン酢': ['ぽん酢', 'ポン酢', 'ポン酢しょうゆ', 'ポン酢醤油'],
    'だし': ['ダシ', '出汁', 'だし汁', '出し汁'],
    '中華だし': ['ちゅうかだし', 'チュウカダシ', '中華だし'],
    
    // 魚介類（缶詰含む）
    'ツナ': ['つな', 'ツナ', 'tuna', 'まぐろ缶'],
    '削りがつお': ['けずりがつお', 'ケズリガツオ', 'かつお節', '鰹節'],
    
    // 果物
    'りんご': ['リンゴ', '林檎', 'アップル', 'apple'],
    'みかん': ['ミカン', '蜜柑', 'オレンジ'],
    'バナナ': ['ばなな', 'バナナ', 'banana'],
    'いちご': ['イチゴ', '苺', 'ストロベリー'],
    'ぶどう': ['ブドウ', '葡萄', 'グレープ'],
    'レモン': ['れもん', 'レモン', 'lemon'],
  };
  
  /// 除外パターン（材料ではないもの）
  static const List<String> excludePatterns = [
    // 調理器具
    'フライパン', '鍋', 'ボウル', '包丁', 'まな板', 'ざる', 'ザル',
    'おたま', 'ヘラ', 'スプーン', 'フォーク', '箸', '計量カップ',
    
    // 調理方法・状態
    '冷凍', '冷蔵', '常温', '生', '茹で', 'ゆで', '焼き', '煮',
    '蒸し', '揚げ', '炒め', '和え', '混ぜ', '切る', '刻む',
    
    // 条件文
    'お好みで', '適宜', '必要に応じて', 'あれば', 'なければ',
    '大きめなら', '小さめなら', '場合は', 'ときは',
    
    // その他
    '飾り用', '仕上げ用', 'トッピング用', '付け合わせ',
    
    // 栄養成分（材料ではない）
    'エネルギー', 'カロリー', 'たんぱく質', 'タンパク質', '蛋白質',
    '脂質', '脂肪', '炭水化物', '糖質', '食物繊維', 'ビタミン',
    'ミネラル', 'カルシウム', '鉄分', '塩分', 'ナトリウム',
  ];
  
  /// 単位の正規化マップ
  static const Map<String, String> unitNormalization = {
    'グラム': 'g',
    'ｇ': 'g',
    'キロ': 'kg',
    'ｋｇ': 'kg',
    'ミリリットル': 'ml',
    'ｍｌ': 'ml',
    'リットル': 'L',
    'Ｌ': 'L',
    'cc': 'ml',
    'コ': '個',
    '人分': '人前',
    'カップ': 'cup',
    'つ': '個',
    'ケ': '個',
    '玉': '個',
    '本': '本',
    '枚': '枚',
    '束': '束',
    '袋': '袋',
    'パック': 'pack',
    '缶': '缶',
    '瓶': '瓶',
  };
  
  /// 材料名を正規化
  static String normalize(String ingredientName) {
    String normalized = ingredientName.trim().toLowerCase();
    
    // 1. 完全一致チェック（最優先）
    for (final entry in commonIngredients.entries) {
      final standardName = entry.key;
      final variations = entry.value;
      
      if (standardName.toLowerCase() == normalized ||
          variations.any((v) => v.toLowerCase() == normalized)) {
        return standardName;
      }
    }
    
    // 2. 長い材料名から順にマッチングチェック（より具体的なマッチングを優先）
    final sortedEntries = commonIngredients.entries.toList();
    sortedEntries.sort((a, b) => b.key.length.compareTo(a.key.length));
    
    for (final entry in sortedEntries) {
      final standardName = entry.key;
      final variations = entry.value;
      
      // 標準名が含まれるかチェック
      if (normalized.contains(standardName.toLowerCase())) {
        return standardName;
      }
      
      // バリエーションが含まれるかチェック
      for (final variation in variations) {
        if (normalized.contains(variation.toLowerCase())) {
          return standardName;
        }
      }
    }
    
    return ingredientName;
  }
  
  /// 材料かどうかを判定
  static bool isIngredient(String text) {
    final lowerText = text.toLowerCase();
    
    // 除外パターンチェック
    for (final pattern in excludePatterns) {
      if (lowerText.contains(pattern.toLowerCase())) {
        return false;
      }
    }
    
    // 材料らしいパターンがあるかチェック
    // 数量がある
    if (RegExp(r'\d+').hasMatch(text)) {
      return true;
    }
    
    // 単位がある
    for (final unit in unitNormalization.keys) {
      if (text.contains(unit)) {
        return true;
      }
    }
    
    // 既知の材料名が含まれる
    // キーをチェック
    for (final key in commonIngredients.keys) {
      if (lowerText.contains(key.toLowerCase())) {
        return true;
      }
    }
    
    // 値（エイリアス）をチェック
    for (final ingredients in commonIngredients.values) {
      for (final ingredient in ingredients) {
        if (lowerText.contains(ingredient.toLowerCase())) {
          return true;
        }
      }
    }
    
    return false;
  }
  
  /// カテゴリを判定
  static String? getCategory(String ingredientName) {
    final normalized = normalize(ingredientName).toLowerCase();
    
    // カテゴリマップ
    final categoryMap = {
      '肉類': [
        // 豚肉部位
        '豚バラ肉', '豚ロース', '豚もも肉', '豚肩肉', '豚ひき肉', '豚こま肉',
        // 牛肉部位
        '牛バラ肉', '牛ロース', '牛もも肉', '牛肩肉', '牛ひき肉', '牛こま肉',
        // 鶏肉部位
        '鶏もも肉', '鶏むね肉', '鶏ささみ', '鶏手羽', '鶏ひき肉',
        // 加工肉
        'ベーコン', 'ハム', 'ソーセージ'
      ],
      '魚介類': ['鮭', 'まぐろ', 'さば', 'いわし', 'あじ', 'えび', 'いか', 'たこ', '貝'],
      '野菜類': ['玉ねぎ', '人参', 'じゃがいも', 'キャベツ', 'トマト', 'なす', 'ピーマン', 'きゅうり', '大根', '白菜'],
      'きのこ類': ['しいたけ', 'えのき', 'しめじ', 'まいたけ', 'エリンギ'],
      '豆類': ['豆腐', '納豆', '大豆', '枝豆', 'ひよこ豆', 'レンズ豆'],
      '卵・乳製品': ['卵', '牛乳', 'チーズ', 'バター', 'ヨーグルト', '生クリーム'],
      '調味料': ['塩', '砂糖', '醤油', '味噌', '酢', '油', 'みりん', '酒', 'ごま', 'ポン酢', 'だし'],
      '主食': ['米', 'パン', 'うどん', 'そば', 'パスタ', 'そうめん', 'スパゲッティ'],
      '果物': ['りんご', 'みかん', 'バナナ', 'いちご', 'ぶどう', 'レモン'],
    };
    
    for (final entry in categoryMap.entries) {
      if (entry.value.any((item) => normalized.contains(item))) {
        return entry.key;
      }
    }
    
    return null;
  }
}